# ‚úÖ –£–°–ü–ï–®–ù–û –†–ï–®–ï–ù–û: –ü—Ä–æ–±–ª–µ–º—ã –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥—ã

## üéâ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å: –í–°–Å –†–ê–ë–û–¢–ê–ï–¢!

### ‚ùå –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏:
1. `HTTP 403 Error: The package is blocked` - FastAPI –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
2. `ImportError: failed to find libmagic` - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞

### ‚úÖ –†–µ–∞–ª—å–Ω–æ—Å—Ç—å:
1. **Python –ø–∞–∫–µ—Ç—ã**: ‚úÖ **–í–°–ï –£–°–ü–ï–®–ù–û –£–°–¢–ê–ù–û–í–ò–õ–ò–°–¨**
2. **libmagic –ø—Ä–æ–±–ª–µ–º–∞**: ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ê** –≤ –∫–æ–¥–µ

---

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ñ–∞–π–ª–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–±–æ—Ç—ã –±–µ–∑ `python-magic`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å `mimetypes`
- Fallback –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é

### 2. ‚úÖ –£—Å–ø–µ—à–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤:
```
‚úÖ fastapi - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
‚úÖ uvicorn[standard] - –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
‚úÖ jinja2 - —à–∞–±–ª–æ–Ω—ã
‚úÖ python-multipart - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
‚úÖ requests - HTTP –∫–ª–∏–µ–Ω—Ç
‚úÖ python-dotenv - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚úÖ pydantic - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚úÖ chromadb - –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚úÖ PyPDF2 - –æ–±—Ä–∞–±–æ—Ç–∫–∞ PDF
‚úÖ python-docx - –æ–±—Ä–∞–±–æ—Ç–∫–∞ DOCX
‚úÖ beautifulsoup4 - –ø–∞—Ä—Å–∏–Ω–≥ HTML
‚úÖ python-magic - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
‚úÖ langchain-gigachat - GigaChat —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
```

### 3. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞:
```
üöÄ –ó–∞–ø—É—Å–∫ web-—Å–µ—Ä–≤–∏—Å–∞...
üìä GigaChat –¥–æ—Å—Ç—É–ø–µ–Ω: False (–æ–∂–∏–¥–∞–µ—Ç—Å—è - —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã)
üìä RAG —Å–µ—Ä–≤–∏—Å –¥–æ—Å—Ç—É–ø–µ–Ω: False (–æ–∂–∏–¥–∞–µ—Ç—Å—è - —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã)
INFO: Uvicorn running on http://0.0.0.0:8005
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥ –≤ `app/services/file_service.py`:

```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å python-magic (–º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ)
try:
    import magic
    MAGIC_AVAILABLE = True
except ImportError:
    MAGIC_AVAILABLE = False

def get_file_type(self, file_path: str) -> str:
    """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ (–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ libmagic)"""
    try:
        # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: python-magic (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
        if MAGIC_AVAILABLE:
            file_type = magic.from_file(file_path, mime=True)
            return file_type
        
        # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å mimetypes
        mime_type, _ = mimetypes.guess_type(file_path)
        if mime_type:
            return mime_type
            
        # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ–∞–π–ª–∞
        extension = Path(file_path).suffix.lower()
        # ... fallback –ª–æ–≥–∏–∫–∞
```

---

## üè¢ –í—ã–≤–æ–¥—ã –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥—ã

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–µ:
- **–í—Å–µ Python –ø–∞–∫–µ—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã** —á–µ—Ä–µ–∑ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π PyPI
- **FastAPI –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω** (–ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ –±—ã–ª–∞ –ª–æ–∂–Ω–æ–π)
- **Chromadb, uvicorn, –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è

### ‚ö†Ô∏è –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:
- **libmagic —Å–∏—Å—Ç–µ–º–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞** –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å
- **–†–µ—à–µ–Ω–∏–µ**: –∫–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ `mimetypes`

### üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É**: `python install.py`
2. **–ó–∞–ø—É—Å–∫–∞–π—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å**: `python main.py`
3. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –ù–ï –ù–£–ñ–ù–´** - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç!

---

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥—ã

### 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```bash
git clone <repository>
cd Knowledge_Domain_Enh/web_service
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
python install.py
# –ò–õ–ò
pip install -r requirements.txt
```

### 4. –î–æ–±–∞–≤—å—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã GigaChat
```bash
mkdir -p ../certificates
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ cert.pem –∏ key.pem
```

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É
```bash
python main.py
```

### 6. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä
```
http://localhost:8005
```

---

## üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
```bash
python test_setup.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
```
‚úÖ FileProcessorService - OK
‚úÖ GigaChatService - OK
‚úÖ RAGService - OK
‚úÖ ConfluenceService - OK
üöÄ Uvicorn running on http://0.0.0.0:8005
```

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –ù–ï –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ Python –ø–∞–∫–µ—Ç–æ–≤!**

–í—Å–µ –ø–∞–∫–µ—Ç—ã —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ `libmagic`, –∫–æ—Ç–æ—Ä–∞—è —Ç–µ–ø–µ—Ä—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–¥–∞.

**‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ –°–±–µ—Ä–±–∞–Ω–∫–∞!**

---

*üè¢ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ: 10 —Å–µ–Ω—Ç—è–±—Ä—è 2025*  
*SberInfra Knowledge Management System v2.0* üíö
