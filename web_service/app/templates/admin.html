{% extends "base.html" %}

{% block title %}–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - {{ app_name }}{% endblock %}

{% block extra_css %}
<style>
    .admin-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .admin-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #3498db;
    }

    .admin-card h3 {
        color: #2c3e50;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-bottom: 20px;
    }

    .stat-item {
        text-align: center;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
    }

    .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #3498db;
    }

    .stat-label {
        color: #666;
        font-size: 14px;
    }

    .form-section {
        margin-bottom: 25px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
    }

    .form-section h4 {
        margin-bottom: 15px;
        color: #2c3e50;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 15px;
    }

    .full-width {
        grid-column: 1 / -1;
    }

    .file-upload-area {
        border: 2px dashed #ddd;
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        background: #f8f9fa;
        transition: all 0.3s;
    }

    .file-upload-area:hover {
        border-color: #3498db;
        background: #e3f2fd;
    }

    .file-upload-area.dragover {
        border-color: #2980b9;
        background: #bbdefb;
    }

    .upload-icon {
        font-size: 3em;
        color: #ddd;
        margin-bottom: 15px;
    }

    .file-list {
        margin-top: 15px;
    }

    .file-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        background: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        margin-bottom: 5px;
    }

    .progress-bar {
        width: 100%;
        height: 20px;
        background: #f0f0f0;
        border-radius: 10px;
        overflow: hidden;
        margin: 10px 0;
    }

    .progress-fill {
        height: 100%;
        background: #27ae60;
        transition: width 0.3s;
    }

    .confluence-test-result {
        margin-top: 15px;
        padding: 15px;
        border-radius: 10px;
        display: none;
    }

    .form-text {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
    }

    .alert {
        padding: 15px;
        border-radius: 10px;
        margin-top: 15px;
    }

    .alert-success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
    }

    .alert-error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
    }

    textarea.form-control {
        min-height: 100px;
        resize: vertical;
        font-family: monospace;
        font-size: 13px;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    .tab-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }

    .tab-button {
        padding: 10px 20px;
        background: #e9ecef;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .tab-button.active {
        background: #3498db;
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="stats-grid">
    <div class="stat-item">
        <div class="stat-number">{{ stats.total_documents }}</div>
        <div class="stat-label">–î–æ–∫—É–º–µ–Ω—Ç–æ–≤</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">{{ stats.total_chunks }}</div>
        <div class="stat-label">–§—Ä–∞–≥–º–µ–Ω—Ç–æ–≤</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">{{ stats.confluence_pages }}</div>
        <div class="stat-label">–°—Ç—Ä–∞–Ω–∏—Ü Confluence</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">{{ stats.uploaded_files }}</div>
        <div class="stat-label">–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤</div>
    </div>
</div>

<div class="tab-buttons">
    <button class="tab-button active" onclick="switchTab('confluence')">üåê Confluence</button>
    <button class="tab-button" onclick="switchTab('files')">üìÅ –§–∞–π–ª—ã</button>
    <button class="tab-button" onclick="switchTab('database')">üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</button>
</div>

<div id="confluenceTab" class="tab-content active">
    <div class="admin-card">
        <h3>üåê –ü–∞—Ä—Å–∏–Ω–≥ Confluence</h3>
        
        <form id="confluenceForm">
            <div class="form-section">
                <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h4>
                <div class="form-row">
                    <div>
                        <label class="form-label">URL Confluence</label>
                        <input type="url" class="form-control" id="confluenceUrl" 
                               placeholder="https://company.atlassian.net/wiki" required>
                    </div>
                    <div>
                        <label class="form-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</label>
                        <input type="text" class="form-control" id="confluenceUsername" 
                               placeholder="user@company.com" required>
                    </div>
                </div>
                <div class="form-row">
                    <div>
                        <label class="form-label">–ü–∞—Ä–æ–ª—å/API Token</label>
                        <input type="password" class="form-control" id="confluencePassword" 
                               placeholder="API Token –∏–ª–∏ –ø–∞—Ä–æ–ª—å" required>
                    </div>
                    <div>
                        <label class="form-label">–ú–∞–∫—Å–∏–º—É–º —Å—Ç—Ä–∞–Ω–∏—Ü</label>
                        <input type="number" class="form-control" id="maxPages" 
                               value="50" min="1" max="1000">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h4>–ò—Å—Ç–æ—á–Ω–∏–∫ —Å—Ç—Ä–∞–Ω–∏—Ü</h4>
                <div class="form-row">
                    <div>
                        <label class="form-label">–ö–ª—é—á –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (Space Key)</label>
                        <input type="text" class="form-control" id="spaceKey" 
                               placeholder="PROJ (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü)">
                    </div>
                    <div>
                        <label class="form-label">ID —Å—Ç—Ä–∞–Ω–∏—Ü (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                        <input type="text" class="form-control" id="pageIds" 
                               placeholder="123456,789012 (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞)">
                    </div>
                </div>
                
                <div class="form-row">
                    <div>
                        <label class="form-label">–ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ —Å—Ç—Ä–æ–∫—É)</label>
                        <textarea class="form-control" id="pageUrls" rows="4" 
                                placeholder="https://company.atlassian.net/wiki/spaces/PROJ/pages/123456/Page+Title
https://company.atlassian.net/wiki/display/PROJ/Another+Page
https://company.atlassian.net/wiki/pages/viewpage.action?pageId=789012"></textarea>
                        <small class="form-text">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã URL Confluence</small>
                    </div>
                    <div>
                        <label class="form-label">–£—Ä–æ–≤–Ω–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–æ—á–µ—Ä–Ω–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü</label>
                        <select class="form-control" id="parseLevels">
                            <option value="1">1 —É—Ä–æ–≤–µ–Ω—å (—Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)</option>
                            <option value="2">2 —É—Ä–æ–≤–Ω—è (+ –ø—Ä—è–º—ã–µ –¥–æ—á–µ—Ä–Ω–∏–µ)</option>
                            <option value="3">3 —É—Ä–æ–≤–Ω—è (+ –¥–æ—á–µ—Ä–Ω–∏–µ –¥–æ—á–µ—Ä–Ω–∏—Ö)</option>
                            <option value="4">4 —É—Ä–æ–≤–Ω—è</option>
                            <option value="5">5 —É—Ä–æ–≤–Ω–µ–π (–º–∞–∫—Å–∏–º—É–º)</option>
                        </select>
                        <small class="form-text">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞</small>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 10px;">
                <button type="button" class="btn btn-secondary" onclick="testConfluenceConnection()">
                    –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                </button>
                <button type="submit" class="btn btn-primary">
                    –ù–∞—á–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥
                </button>
            </div>
        </form>

        <div id="confluenceResult" class="confluence-test-result"></div>
        
        <div id="confluenceProgress" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="confluenceProgressBar"></div>
            </div>
            <div id="confluenceStatus">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</div>
        </div>
    </div>
</div>

<div id="filesTab" class="tab-content">
    <div class="admin-card">
        <h3>üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h3>
        
        <div class="file-upload-area" id="uploadArea">
            <div class="upload-icon">üìÅ</div>
            <h4>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</h4>
            <p>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PDF, DOCX, DOC, TXT</p>
            <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 50 MB</p>
            <input type="file" id="fileInput" multiple accept=".pdf,.docx,.doc,.txt" style="display: none;">
            <button type="button" class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
            </button>
        </div>

        <div id="fileList" class="file-list"></div>
    </div>
</div>

<div id="databaseTab" class="tab-content">
    <div class="admin-card">
        <h3>üóÑÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö</h3>
        
        <div class="form-section">
            <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã</h4>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number" id="dbTotalChunks">{{ stats.total_chunks }}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="dbTotalDocs">{{ stats.total_documents }}</div>
                    <div class="stat-label">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</div>
                </div>
            </div>
        </div>

        <div class="form-section">
            <h4>–î–µ–π—Å—Ç–≤–∏—è</h4>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="refreshStats()">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                </button>
                <button class="btn btn-danger" onclick="clearDatabase()" 
                        onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')">
                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
function switchTab(tabName) {
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å –∫–Ω–æ–ø–æ–∫
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é –≤–∫–ª–∞–¥–∫—É
    document.getElementById(tabName + 'Tab').classList.add('active');
    event.target.classList.add('active');
}

// –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Confluence
async function testConfluenceConnection() {
    const url = document.getElementById('confluenceUrl').value;
    const username = document.getElementById('confluenceUsername').value;
    const password = document.getElementById('confluencePassword').value;

    if (!url || !username || !password) {
        showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
        return;
    }

    const resultDiv = document.getElementById('confluenceResult');
    resultDiv.style.display = 'block';
    resultDiv.className = 'confluence-test-result alert alert-warning';
    resultDiv.innerHTML = 'üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...';

    try {
        const response = await fetch('/api/confluence/test', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                url: url,
                username: username,
                password: password
            })
        });

        const result = await response.json();

        if (result.success) {
            resultDiv.className = 'confluence-test-result alert alert-success';
            resultDiv.innerHTML = `‚úÖ ${result.message}`;
        } else {
            resultDiv.className = 'confluence-test-result alert alert-error';
            resultDiv.innerHTML = `‚ùå ${result.message}`;
        }
    } catch (error) {
        resultDiv.className = 'confluence-test-result alert alert-error';
        resultDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
    }
}

// –ü–∞—Ä—Å–∏–Ω–≥ Confluence
document.getElementById('confluenceForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const formData = {
        config: {
            url: document.getElementById('confluenceUrl').value,
            username: document.getElementById('confluenceUsername').value,
            password: document.getElementById('confluencePassword').value,
            space_key: document.getElementById('spaceKey').value || null,
            page_ids: document.getElementById('pageIds').value ? 
                      document.getElementById('pageIds').value.split(',').map(id => id.trim()) : null,
            page_urls: document.getElementById('pageUrls').value ? 
                      document.getElementById('pageUrls').value.split('\n')
                          .map(url => url.trim())
                          .filter(url => url.length > 0) : null,
            parse_levels: parseInt(document.getElementById('parseLevels').value)
        },
        max_pages: parseInt(document.getElementById('maxPages').value),
        include_attachments: false,
        parse_child_pages: parseInt(document.getElementById('parseLevels').value) > 1
    };

    const progressDiv = document.getElementById('confluenceProgress');
    const statusDiv = document.getElementById('confluenceStatus');
    
    progressDiv.style.display = 'block';
    statusDiv.textContent = '–ù–∞—á–∏–Ω–∞–µ–º –ø–∞—Ä—Å–∏–Ω–≥...';

    try {
        const response = await fetch('/api/confluence/parse', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (result.success) {
            statusDiv.innerHTML = `‚úÖ ${result.message}`;
            showAlert(`–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${result.processed_pages} —Å—Ç—Ä–∞–Ω–∏—Ü`, 'success');
            refreshStats();
        } else {
            statusDiv.innerHTML = `‚ùå ${result.message}`;
            showAlert('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ Confluence', 'error');
        }
    } catch (error) {
        statusDiv.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
        showAlert(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
    }
});

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');
const fileList = document.getElementById('fileList');

// Drag & Drop
uploadArea.addEventListener('dragover', function(e) {
    e.preventDefault();
    uploadArea.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', function(e) {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
});

uploadArea.addEventListener('drop', function(e) {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
    
    const files = Array.from(e.dataTransfer.files);
    handleFiles(files);
});

fileInput.addEventListener('change', function(e) {
    const files = Array.from(e.target.files);
    handleFiles(files);
});

async function handleFiles(files) {
    for (const file of files) {
        await uploadFile(file);
    }
    refreshStats();
}

async function uploadFile(file) {
    const fileItem = document.createElement('div');
    fileItem.className = 'file-item';
    fileItem.innerHTML = `
        <div>
            <strong>${file.name}</strong><br>
            <small>${(file.size / 1024 / 1024).toFixed(2)} MB</small>
        </div>
        <div id="status-${file.name}">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    `;
    fileList.appendChild(fileItem);

    const formData = new FormData();
    formData.append('file', file);

    try {
        const response = await fetch('/api/upload', {
            method: 'POST',
            body: formData
        });

        const result = await response.json();
        const statusElement = document.getElementById(`status-${file.name}`);

        if (result.status === 'success') {
            statusElement.innerHTML = '‚úÖ –£—Å–ø–µ—à–Ω–æ';
            statusElement.style.color = '#27ae60';
            showAlert(`–§–∞–π–ª ${file.name} —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω`, 'success');
        } else {
            statusElement.innerHTML = '‚ùå –û—à–∏–±–∫–∞';
            statusElement.style.color = '#e74c3c';
            showAlert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${file.name}: ${result.message}`, 'error');
        }
    } catch (error) {
        const statusElement = document.getElementById(`status-${file.name}`);
        statusElement.innerHTML = '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏';
        statusElement.style.color = '#e74c3c';
        showAlert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${file.name}: ${error.message}`, 'error');
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
async function refreshStats() {
    try {
        const response = await fetch('/api/admin/stats');
        const stats = await response.json();

        document.getElementById('dbTotalChunks').textContent = stats.total_chunks;
        document.getElementById('dbTotalDocs').textContent = stats.total_documents;

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        document.querySelectorAll('.stat-number').forEach((el, index) => {
            switch(index) {
                case 0: el.textContent = stats.total_documents; break;
                case 1: el.textContent = stats.total_chunks; break;
                case 2: el.textContent = stats.confluence_pages; break;
                case 3: el.textContent = stats.uploaded_files; break;
            }
        });

        showAlert('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
    } catch (error) {
        showAlert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏', 'error');
    }
}

// –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
async function clearDatabase() {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
        return;
    }

    try {
        const response = await fetch('/api/admin/clear-db', {
            method: 'DELETE'
        });

        const result = await response.json();

        if (result.success) {
            showAlert('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—á–∏—â–µ–Ω–∞', 'success');
            refreshStats();
        } else {
            showAlert('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö', 'error');
        }
    } catch (error) {
        showAlert(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
    }
}

// –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
setInterval(refreshStats, 30000);
</script>
{% endblock %}
